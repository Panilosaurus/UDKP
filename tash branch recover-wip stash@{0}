[1mdiff --git a/server.js b/server.js[m
[1mindex 1890433..52da797 100644[m
[1m--- a/server.js[m
[1m+++ b/server.js[m
[36m@@ -30,11 +30,44 @@[m [mapp.use([m
     saveUninitialized: false,[m
   })[m
 );[m
[32m+[m
[32m+[m[32mapp.use((req, res, next) => {[m
[32m+[m[32m  res.locals.nama  = (req.session?.user?.nama)  || "Guest";[m
[32m+[m[32m  res.locals.role  = (req.session?.user?.role)  || null;   // <-- tambahkan[m
[32m+[m[32m  res.locals.status= (req.session?.user?.status)|| null;   // <-- opsional[m
[32m+[m[32m  next();[m
[32m+[m[32m});[m
[32m+[m
[32m+[m[32m// Simpan nama user agar bisa diakses di semua halaman EJS[m
 app.use((req, res, next) => {[m
   res.locals.nama =[m
     (req.session && req.session.user && req.session.user.nama) || "Guest";[m
   next();[m
 });[m
[32m+[m
[32m+[m[32m// âœ… Tambahkan middleware untuk autentikasi & otorisasi[m
[32m+[m[32mfunction requireLogin(req, res, next) {[m
[32m+[m[32m  if (!req.session.user) {[m
[32m+[m[32m    return res.redirect("/login");[m
[32m+[m[32m  }[m
[32m+[m[32m  next();[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction requireRole(...roles) {[m
[32m+[m[32m  return (req, res, next) => {[m
[32m+[m[32m    if (!req.session.user) {[m
[32m+[m[32m      return res.redirect("/login");[m
[32m+[m[32m    }[m
[32m+[m[32m    if (!roles.includes(req.session.user.role)) {[m
[32m+[m[32m      return res[m
[32m+[m[32m        .status(403)[m
[32m+[m[32m        .send("Akses ditolak: Anda tidak memiliki izin untuk halaman ini.");[m
[32m+[m[32m    }[m
[32m+[m[32m    next();[m
[32m+[m[32m  };[m
[32m+[m[32m}[m
[32m+[m[32m// âœ… Akhir tambahan middleware[m
[32m+[m
 // Middleware untuk static files[m
 app.use(express.static(path.join(__dirname, "public")));[m
 [m
[36m@@ -42,6 +75,7 @@[m [mapp.use(express.static(path.join(__dirname, "public")));[m
 app.set("views", path.join(__dirname, "views"));[m
 app.set("view engine", "ejs");[m
 [m
[32m+[m
 // Route utama â†’ ambil data dari tabel[m
 app.get("/", async (req, res) => {[m
   try {[m
[36m@@ -143,7 +177,7 @@[m [mapp.get("/", async (req, res) => {[m
   ORDER BY instansi ASC[m
 `);[m
 [m
[31m-    // ðŸ”¹ Ambil nilai tertinggi dan terendah dari semua jenis ujian[m
[32m+[m[32m // ðŸ”¹ Ambil nilai tertinggi dan terendah dari semua jenis ujian[m
     const [nilaiMinMax] = await db.promise().query(`[m
   SELECT[m
     GREATEST([m
[36m@@ -252,6 +286,7 @@[m [mapp.post("/register", async (req, res) => {[m
   }[m
 });[m
 [m
[32m+[m[32m// LOGIN[m
 // LOGIN[m
 app.post("/login", async (req, res) => {[m
   try {[m
[36m@@ -262,44 +297,45 @@[m [mapp.post("/login", async (req, res) => {[m
 [m
     if (!rows.length) {[m
       return res.render("login", {[m
[31m-        modal: {[m
[31m-          type: "error",[m
[31m-          title: "Login Gagal",[m
[31m-          message: "Username tidak ditemukan.",[m
[31m-        },[m
[32m+[m[32m        modal: { type: "error", title: "Login Gagal", message: "Username tidak ditemukan." },[m
       });[m
     }[m
 [m
     const user = rows[0];[m
[32m+[m
[32m+[m[32m    // Blokir user nonaktif[m
[32m+[m[32m    if (user.status && user.status.toLowerCase() === "nonaktif") {[m
[32m+[m[32m      return res.render("login", {[m
[32m+[m[32m        modal: { type: "error", title: "Akun Nonaktif", message: "Hubungi admin untuk mengaktifkan akun Anda." },[m
[32m+[m[32m      });[m
[32m+[m[32m    }[m
[32m+[m
     const ok = await bcrypt.compare(password, user.password);[m
     if (!ok) {[m
       return res.render("login", {[m
[31m-        modal: {[m
[31m-          type: "error",[m
[31m-          title: "Login Gagal",[m
[31m-          message: "Password salah.",[m
[31m-        },[m
[32m+[m[32m        modal: { type: "error", title: "Login Gagal", message: "Password salah." },[m
       });[m
     }[m
 [m
[32m+[m[32m    // âœ… simpan lengkap, termasuk role & status[m
     req.session.user = {[m
       id: user.id_akun,[m
       username: user.username,[m
       nama: `${user.nama_depan || ""} ${user.nama_belakang || ""}`.trim(),[m
[32m+[m[32m      role: user.role,        // <-- penting[m
[32m+[m[32m      status: user.status     // <-- penting[m
     };[m
[32m+[m
     return res.redirect("/");[m
   } catch (err) {[m
     console.error(err);[m
     res.render("login", {[m
[31m-      modal: {[m
[31m-        type: "error",[m
[31m-        title: "Kesalahan Server",[m
[31m-        message: "Terjadi kesalahan. Coba lagi nanti.",[m
[31m-      },[m
[32m+[m[32m      modal: { type: "error", title: "Kesalahan Server", message: "Terjadi kesalahan. Coba lagi nanti." },[m
     });[m
   }[m
 });[m
 [m
[32m+[m
 // HAPUS DATA[m
 app.delete("/hapus/:id", (req, res) => {[m
   const { id } = req.params;[m
[36m@@ -981,26 +1017,43 @@[m [mapp.post('/update-status/:groupId', async (req, res) => {[m
 app.post('/update-status', async (req, res) => {[m
   try {[m
     const { group_id, status } = req.body;[m
[31m-    if (!group_id || !status) return res.status(400).json({ success:false, message:'Data tidak lengkap.' });[m
[32m+[m[32m    if (!group_id || !status) return res.status(400).json({ success: false, message: 'Data tidak lengkap.' });[m
     await db.promise().query('UPDATE tabel SET status=? WHERE group_id=?', [status, group_id]);[m
[31m-    res.json({ success:true });[m
[32m+[m[32m    res.json({ success: true });[m
   } catch (e) {[m
     console.error('âŒ update-status:', e);[m
[31m-    res.status(500).json({ success:false, message:'Kesalahan server.' });[m
[32m+[m[32m    res.status(500).json({ success: false, message: 'Kesalahan server.' });[m
   }[m
 });[m
 [m
[31m-// Manajemen Akun â€“ list akun sederhana[m
[31m-app.get('/akun', async (req, res) => {[m
[32m+[m[32mapp.get("/akun", requireLogin, requireRole("admin"), async (req, res) => {[m
   try {[m
[31m-    const [rows] = await db.promise().query([m
[31m-      'SELECT id_akun, username, nama_depan, nama_belakang FROM akun ORDER BY id_akun DESC'[m
[31m-    );[m
[31m-    res.render('akun', { users: rows });[m
[32m+[m[32m    const [rows] = await db.promise().query(`[m
[32m+[m[32m      SELECT[m
[32m+[m[32m        id_akun AS id,[m
[32m+[m[32m        username,[m
[32m+[m[32m        nama_depan,[m
[32m+[m[32m        nama_belakang,[m
[32m+[m[32m        role,[m
[32m+[m[32m        status[m
[32m+[m[32m      FROM akun[m
[32m+[m[32m      ORDER BY id_akun ASC[m
[32m+[m[32m    `);[m
[32m+[m
[32m+[m[32m    const users = rows.map(u => ({[m
[32m+[m[32m      id: u.id,[m
[32m+[m[32m      username: u.username,[m
[32m+[m[32m      nama: (`${u.nama_depan || ''} ${u.nama_belakang || ''}`).trim() || '-',[m
[32m+[m[32m      role: u.role || 'viewer',[m
[32m+[m[32m      status: u.status || 'nonaktif',[m
[32m+[m[32m    }));[m
[32m+[m
[32m+[m[32m    res.render("akun", { users });[m
   } catch (err) {[m
[31m-    console.error('GET /akun', err);[m
[31m-    res.status(500).send('Gagal memuat halaman akun');[m
[32m+[m[32m    console.error("GET /akun error:", err);[m
[32m+[m[32m    res.status(500).send("Gagal memuat halaman akun");[m
   }[m
 });[m
 [m
 [m
[41m+[m
[1mdiff --git a/views/akun.ejs b/views/akun.ejs[m
[1mindex 760e923..4254284 100644[m
[1m--- a/views/akun.ejs[m
[1m+++ b/views/akun.ejs[m
[36m@@ -1,5 +1,6 @@[m
 <!DOCTYPE html>[m
 <html lang="en">[m
[32m+[m
 <head>[m
   <meta charset="UTF-8" />[m
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />[m
[36m@@ -10,6 +11,7 @@[m
   <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css" />[m
   <link href="/css/sb-admin-2.min.css" rel="stylesheet" />[m
 </head>[m
[32m+[m
 <body id="page-top">[m
   <!-- Page Wrapper -->[m
   <div id="wrapper">[m
[36m@@ -64,7 +66,8 @@[m
           <ul class="navbar-nav ml-auto">[m
             <!-- Nav Item - User Information (dummy) -->[m
             <li class="nav-item dropdown no-arrow">[m
[31m-              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">[m
[32m+[m[32m              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown"[m
[32m+[m[32m                aria-haspopup="true" aria-expanded="false">[m
                 <span class="mr-2 d-none d-lg-inline text-gray-600 small">Admin</span>[m
                 <img class="img-profile rounded-circle" src="/img/undraw_profile.svg" />[m
               </a>[m
[36m@@ -72,7 +75,8 @@[m
               <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">[m
                 <a class="dropdown-item" href="#"><i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i> Profile</a>[m
                 <div class="dropdown-divider"></div>[m
[31m-                <a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i> Logout</a>[m
[32m+[m[32m                <a class="dropdown-item" href="/logout"><i[m
[32m+[m[32m                    class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i> Logout</a>[m
               </div>[m
             </li>[m
           </ul>[m
[36m@@ -100,7 +104,8 @@[m
               <form class="row">[m
                 <div class="col-md-4 mb-2">[m
                   <label class="small text-gray-600 mb-1">Cari (Nama / Username)</label>[m
[31m-                  <input id="filterKeyword" type="text" class="form-control" placeholder="ketik kata kunci..." oninput="filterTable()" />[m
[32m+[m[32m                  <input id="filterKeyword" type="text" class="form-control" placeholder="ketik kata kunci..."[m
[32m+[m[32m                    oninput="filterTable()" />[m
                 </div>[m
                 <div class="col-md-3 mb-2">[m
                   <label class="small text-gray-600 mb-1">Role</label>[m
[36m@@ -147,46 +152,77 @@[m
                     </tr>[m
                   </thead>[m
                   <tbody>[m
[31m-                    <% if (users && users.length) { %>[m
[31m-                      <% users.forEach((u, i) => { %>[m
[31m-                        <tr data-role="<%= u.role %>" data-status="<%= u.status %>" data-keyword="<%= (u.nama + ' ' + u.username).toLowerCase() %>">[m
[31m-                          <td class="text-center"><%= i + 1 %></td>[m
[31m-                          <td><%= u.nama %></td>[m
[32m+[m[32m                    <% if (Array.isArray(users) && users.length) { %>[m
[32m+[m[32m                      <% users.forEach(function(u, i) { %>[m
[32m+[m[32m                        <tr>[m
[32m+[m[32m                          <td class="text-center">[m
[32m+[m[32m                            <%= i + 1 %>[m
[32m+[m[32m                          </td>[m
[32m+[m
[32m+[m[32m                          <!-- Nama (gabungan nama_depan + nama_belakang) -->[m
[32m+[m[32m                          <td>[m
[32m+[m[32m                            <%= u.nama %>[m
[32m+[m[32m                          </td>[m
[32m+[m
[32m+[m[32m                          <!-- Username -->[m
                           <td><code><%= u.username %></code></td>[m
[32m+[m
[32m+[m[32m                          <!-- Role -->[m
                           <td>[m
[31m-                            <span class="badge <%= u.role==='admin'?'badge-danger':(u.role==='petugas'?'badge-info':'badge-secondary') %>"><%= (u.role || '').toUpperCase() %></span>[m
[32m+[m[32m                            <span[m
[32m+[m[32m                              class="badge <%= u.role === 'admin' ? 'badge-danger' : (u.role === 'petugas' ? 'badge-info' : 'badge-secondary') %>">[m
[32m+[m[32m                              <%= (u.role || '' ).toUpperCase() %>[m
[32m+[m[32m                            </span>[m
                           </td>[m
[32m+[m
[32m+[m[32m                          <!-- Status -->[m
                           <td>[m
[31m-                            <% if (u.status === 'aktif') { %>[m
[32m+[m[32m                            <% if (u.status==='aktif' ) { %>[m
                               <span class="badge badge-success">Aktif</span>[m
[31m-                            <% } else { %>[m
[31m-                              <span class="badge badge-secondary">Nonaktif</span>[m
[31m-                            <% } %>[m
[32m+[m[32m                              <% } else { %>[m
[32m+[m[32m                                <span class="badge badge-secondary">Nonaktif</span>[m
[32m+[m[32m                                <% } %>[m
                           </td>[m
[32m+[m
[32m+[m[32m                          <!-- Aksi: Edit / Toggle Aktif / Reset Password / Hapus -->[m
                           <td class="text-nowrap">[m
[31m-                            <a href="/akun/edit/<%= u.id %>" class="btn btn-sm btn-warning mr-1" title="Edit"><i class="fas fa-edit"></i></a>[m
[32m+[m[32m                            <!-- Edit (bisa arahkan ke modal atau halaman edit) -->[m
[32m+[m[32m                            <a href="/akun/edit/<%= u.id %>" class="btn btn-sm btn-warning mr-1" title="Edit">[m
[32m+[m[32m                              <i class="fas fa-edit"></i>[m
[32m+[m[32m                            </a>[m
 [m
[32m+[m[32m                            <!-- Toggle Aktif/Nonaktif -->[m
                             <form action="/akun/toggle/<%= u.id %>" method="POST" class="d-inline">[m
[31m-                              <button type="submit" class="btn btn-sm <%= u.status==='aktif'?'btn-outline-secondary':'btn-outline-success' %> mr-1" title="Toggle Aktif">[m
[31m-                                <i class="fas <%= u.status==='aktif'?'fa-user-slash':'fa-user-check' %>"></i>[m
[32m+[m[32m                              <button type="submit"[m
[32m+[m[32m                                class="btn btn-sm <%= u.status === 'aktif' ? 'btn-outline-secondary' : 'btn-outline-success' %> mr-1"[m
[32m+[m[32m                                title="Toggle Aktif">[m
[32m+[m[32m                                <i class="fas <%= u.status === 'aktif' ? 'fa-user-slash' : 'fa-user-check' %>"></i>[m
                               </button>[m
                             </form>[m
 [m
[31m-                            <form action="/akun/reset-password/<%= u.id %>" method="POST" class="d-inline" onsubmit="return confirm('Reset password untuk <%= u.username %>?');">[m
[31m-                              <button type="submit" class="btn btn-sm btn-outline-primary mr-1" title="Reset Password"><i class="fas fa-key"></i></button>[m
[32m+[m[32m                            <!-- Reset Password (akan set ke default di backend) -->[m
[32m+[m[32m                            <form action="/akun/reset-password/<%= u.id %>" method="POST" class="d-inline"[m
[32m+[m[32m                              onsubmit="return confirm('Reset password untuk <%= u.username %>?');">[m
[32m+[m[32m                              <button type="submit" class="btn btn-sm btn-outline-primary mr-1" title="Reset Password">[m
[32m+[m[32m                                <i class="fas fa-key"></i>[m
[32m+[m[32m                              </button>[m
                             </form>[m
 [m
[31m-                            <form action="/akun/delete/<%= u.id %>" method="POST" class="d-inline" onsubmit="return confirm('Hapus akun <%= u.username %>? Tindakan ini tidak dapat dibatalkan.');">[m
[31m-                              <button type="submit" class="btn btn-sm btn-danger" title="Hapus"><i class="fas fa-trash"></i></button>[m
[32m+[m[32m                            <!-- Hapus -->[m
[32m+[m[32m                            <form action="/akun/delete/<%= u.id %>" method="POST" class="d-inline"[m
[32m+[m[32m                              onsubmit="return confirm('Hapus akun <%= u.username %>? Tindakan ini tidak dapat dibatalkan.');">[m
[32m+[m[32m                              <button type="submit" class="btn btn-sm btn-danger" title="Hapus">[m
[32m+[m[32m                                <i class="fas fa-trash"></i>[m
[32m+[m[32m                              </button>[m
                             </form>[m
                           </td>[m
                         </tr>[m
[31m-                      <% }) %>[m
[31m-                    <% } else { %>[m
[31m-                      <tr>[m
[31m-                        <td colspan="6" class="text-center text-muted">Belum ada data akun.</td>[m
[31m-                      </tr>[m
[31m-                    <% } %>[m
[32m+[m[32m                        <% }) %>[m
[32m+[m[32m                          <% } else { %>[m
[32m+[m[32m                            <tr>[m
[32m+[m[32m                              <td colspan="6" class="text-center text-muted">Belum ada data akun.</td>[m
[32m+[m[32m                            </tr>[m
[32m+[m[32m                            <% } %>[m
                   </tbody>[m
                 </table>[m
               </div>[m
[36m@@ -222,7 +258,8 @@[m
       <form action="/akun/tambah" method="POST" class="modal-content">[m
         <div class="modal-header">[m
           <h5 class="modal-title">Tambah Akun Baru</h5>[m
[31m-          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>[m
[32m+[m[32m          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span[m
[32m+[m[32m              aria-hidden="true">&times;</span></button>[m
         </div>[m
         <div class="modal-body">[m
           <div class="form-group">[m
[36m@@ -294,4 +331,5 @@[m
     }[m
   </script>[m
 </body>[m
[31m-</html>[m
[32m+[m
[32m+[m[32m</html>[m
\ No newline at end of file[m
